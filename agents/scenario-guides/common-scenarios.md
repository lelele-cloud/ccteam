# 通用场景处理指南

本指南为所有智能体提供常见场景的标准化处理流程，确保团队在面对各类问题时能够高效、一致地响应。

---

## 场景1: 如何拒绝不合理需求

### 识别特征

不合理需求通常具有以下特征：

| 类型 | 特征描述 | 示例 |
|------|----------|------|
| **超出范围** | 需求超出项目或团队职责边界 | 要求后端团队开发移动App |
| **违背价值** | 与产品价值观或用户利益冲突 | 收集不必要的用户隐私数据 |
| **资源不匹配** | 时间、人力、技术能力无法支撑 | 一周内完成三个月的工作量 |
| **技术不可行** | 当前技术条件无法实现 | 要求100%准确率的AI预测 |
| **ROI过低** | 投入产出比严重失衡 | 花费一个月开发仅服务10人的功能 |
| **违反规范** | 违背行业标准或合规要求 | 绕过安全审计流程上线 |

### 处理步骤

```
步骤1: 确认理解
├── 复述需求，确保理解正确
├── 询问背景和期望达成的目标
└── 了解需求的紧迫程度和来源

步骤2: 说明问题
├── 客观陈述无法满足的原因
├── 提供数据或案例支撑
└── 避免情绪化表达

步骤3: 提供替代
├── 提出可行的替代方案
├── 说明替代方案能解决的问题比例
└── 给出替代方案的成本估算

步骤4: 请求决策
├── 将决策权交还给需求方
├── 明确各选项的利弊
└── 记录最终决策及原因
```

### 示例对话

**场景**: 业务方要求在2天内上线一个完整的支付系统

```
智能体: "我理解您希望尽快上线支付功能，以便用户能够完成购买流程。
        让我确认一下，您期望的是完整的支付系统，包括多种支付方式、
        对账、退款等功能吗？"

业务方: "是的，越快越好，业务等着用。"

智能体: "感谢确认。根据我的评估，完整支付系统需要4-6周开发时间，
        主要因为：
        1. 需要对接多个支付渠道API（各需3-5天）
        2. 涉及资金安全，必须完成安全审计
        3. 需要完善的对账和异常处理机制

        我有两个替代方案供您选择：

        方案A（2天可完成）:
        - 仅接入微信支付单一渠道
        - 手动对账
        - 暂不支持退款，需人工处理
        - 可覆盖约70%用户的支付需求

        方案B（2周可完成）:
        - 接入微信+支付宝双渠道
        - 自动对账
        - 支持基本退款流程
        - 可覆盖约95%用户的支付需求

        请问您倾向哪个方案？或者我们可以讨论其他折中方式。"
```

### 沟通原则

- **不说"不行"，说"可以，但是..."** - 展示合作态度
- **用数据说话** - 避免主观判断
- **提供选择** - 让对方有决策空间
- **记录留痕** - 重要决策需书面确认

---

## 场景2: 如何处理技术债务

### 发现时机

技术债务通常在以下时机被发现：

| 时机 | 发现方式 | 常见表现 |
|------|----------|----------|
| **代码评审** | 同行Review | 代码重复、设计模式缺失、命名混乱 |
| **性能测试** | 压力测试 | 响应慢、内存泄漏、并发问题 |
| **安全扫描** | 自动化工具 | 已知漏洞、过期依赖、硬编码密钥 |
| **故障排查** | 线上问题 | 日志不全、监控缺失、容错不足 |
| **新人入职** | 代码阅读 | 文档缺失、架构不清、环境复杂 |
| **功能迭代** | 需求开发 | 难以扩展、修改影响范围大 |

### 评估标准

| 级别 | 名称 | 定义 | 影响范围 | 处理要求 |
|------|------|------|----------|----------|
| **L1** | 致命 | 直接影响系统可用性或安全性 | 全系统 | 立即处理，优先于新功能 |
| **L2** | 严重 | 显著影响开发效率或系统性能 | 多模块 | 当前迭代内处理 |
| **L3** | 一般 | 影响代码可维护性 | 单模块 | 下次触及时修复 |
| **L4** | 轻微 | 代码风格或最佳实践问题 | 单文件 | 有空时优化 |

### 记录格式模板

```markdown
## 技术债务记录

### 基本信息
- **编号**: TD-YYYY-NNNN
- **发现日期**: YYYY-MM-DD
- **发现人**: @xxx
- **所属模块**: xxx-service
- **级别**: L1/L2/L3/L4

### 问题描述
[清晰描述技术债务的内容]

### 影响分析
- **当前影响**: [对系统/开发的具体影响]
- **潜在风险**: [如不处理可能带来的后果]
- **影响范围**: [涉及的模块/功能]

### 产生原因
- [ ] 历史遗留
- [ ] 时间压力
- [ ] 技术演进
- [ ] 需求变更
- [ ] 其他: [说明]

### 解决方案
[描述建议的解决方案]

### 成本估算
- **修复工时**: X人天
- **测试工时**: X人天
- **风险等级**: 高/中/低

### 处理计划
- **目标版本**: vX.X.X
- **负责人**: @xxx
- **预计完成**: YYYY-MM-DD

### 状态跟踪
| 日期 | 状态 | 备注 |
|------|------|------|
| YYYY-MM-DD | 已发现 | - |
```

### 处理原则

1. **持续记录** - 发现即记录，不要依赖记忆
2. **定期盘点** - 每个迭代Review技术债务清单
3. **预算机制** - 每个迭代预留10-20%时间处理技术债务
4. **优先级动态调整** - 根据业务发展重新评估优先级

---

## 场景3: 如何处理安全漏洞

### 紧急响应流程

```
┌─────────────────────────────────────────────────────────────┐
│                      安全漏洞响应流程                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐    ┌────────┐│
│  │ 1.发现   │───→│ 2.评估   │───→│ 3.响应   │───→│ 4.复盘 ││
│  │ 上报     │    │ 定级     │    │ 修复     │    │ 改进   ││
│  └──────────┘    └──────────┘    └──────────┘    └────────┘│
│       │              │              │              │        │
│       ▼              ▼              ▼              ▼        │
│  - 立即上报      - 判断级别     - 执行修复     - 根因分析   │
│  - 保留现场      - 评估影响     - 验证效果     - 流程优化   │
│  - 初步隔离      - 确定方案     - 通知相关方   - 知识沉淀   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 严重程度评估

| 级别 | 名称 | CVSS分数 | 定义 | 示例 |
|------|------|----------|------|------|
| **P0** | 紧急 | 9.0-10.0 | 可被远程利用，无需认证，影响核心数据 | RCE、SQL注入获取全库、认证绕过 |
| **P1** | 高危 | 7.0-8.9 | 需特定条件利用，可获取敏感数据 | 越权访问、敏感信息泄露、SSRF |
| **P2** | 中危 | 4.0-6.9 | 需用户交互或内部网络才能利用 | XSS、CSRF、信息枚举 |
| **P3** | 低危 | 0.1-3.9 | 影响有限，利用难度高 | 低危信息泄露、非敏感配置暴露 |

### 响应时间要求

| 级别 | 确认时间 | 修复时间 | 验证时间 | 通知范围 |
|------|----------|----------|----------|----------|
| **P0** | 15分钟内 | 4小时内 | 1小时内 | CTO、安全团队、相关负责人 |
| **P1** | 1小时内 | 24小时内 | 4小时内 | 安全团队、技术负责人 |
| **P2** | 4小时内 | 7天内 | 1天内 | 安全团队、模块负责人 |
| **P3** | 24小时内 | 30天内 | 3天内 | 安全团队 |

### 响应动作清单

**P0紧急漏洞**:
- [ ] 立即拉起应急响应群
- [ ] 评估是否需要临时下线服务
- [ ] 确定临时缓解措施（WAF规则、IP封禁等）
- [ ] 并行开发修复补丁
- [ ] 准备用户通知公告（如涉及数据泄露）
- [ ] 合规报告（如涉及监管要求）

**P1高危漏洞**:
- [ ] 通知安全团队和技术负责人
- [ ] 评估影响范围和利用难度
- [ ] 制定修复计划并排入最高优先级
- [ ] 部署临时防护措施
- [ ] 完成修复后进行安全验证

---

## 场景4: 如何处理需求变更

### 变更评估流程

```
┌───────────┐     ┌───────────┐     ┌───────────┐     ┌───────────┐
│  变更请求  │────→│  影响评估  │────→│  评审决策  │────→│  执行跟踪  │
└───────────┘     └───────────┘     └───────────┘     └───────────┘
      │                 │                 │                 │
      ▼                 ▼                 ▼                 ▼
  - 变更内容        - 范围影响        - 批准/拒绝      - 更新计划
  - 变更原因        - 技术影响        - 条件批准       - 通知相关方
  - 期望时间        - 进度影响        - 延期处理       - 监控进度
                    - 资源影响
                    - 风险评估
```

### 评估维度

| 维度 | 评估要点 | 评估问题 |
|------|----------|----------|
| **范围影响** | 功能边界变化 | 变更涉及多少个功能模块？是否影响已完成的功能？ |
| **技术影响** | 架构/代码改动 | 需要修改哪些组件？是否涉及数据库变更？是否引入新技术？ |
| **进度影响** | 时间线变化 | 预计增加多少工时？是否影响里程碑？是否需要延期？ |
| **资源影响** | 人力/成本变化 | 是否需要额外人员？是否涉及额外采购？ |
| **风险影响** | 新增/变化风险 | 引入哪些新风险？原有风险是否加剧？ |

### 变更等级

| 等级 | 定义 | 审批要求 | 示例 |
|------|------|----------|------|
| **重大变更** | 影响项目目标、里程碑或超过20%预算 | 项目发起人审批 | 核心功能调整、交付日期变更 |
| **一般变更** | 影响多个模块或超过5%预算 | 项目经理审批 | 新增次要功能、接口调整 |
| **轻微变更** | 单模块内小调整，不影响进度 | 模块负责人审批 | UI微调、文案修改 |

### 变更记录格式

```markdown
## 需求变更记录

### 基本信息
- **变更编号**: CR-YYYY-NNNN
- **申请日期**: YYYY-MM-DD
- **申请人**: @xxx
- **关联需求**: REQ-XXXX

### 变更内容

#### 原始需求
[描述变更前的需求内容]

#### 变更后需求
[描述变更后的需求内容]

#### 变更原因
- [ ] 业务调整
- [ ] 用户反馈
- [ ] 技术限制
- [ ] 外部依赖
- [ ] 其他: [说明]

### 影响评估

| 维度 | 影响程度 | 说明 |
|------|----------|------|
| 范围 | 高/中/低 | |
| 技术 | 高/中/低 | |
| 进度 | 高/中/低 | |
| 资源 | 高/中/低 | |
| 风险 | 高/中/低 | |

### 工作量估算
- **新增工作量**: X人天
- **返工工作量**: X人天
- **测试工作量**: X人天
- **合计**: X人天

### 审批记录
| 角色 | 姓名 | 意见 | 日期 |
|------|------|------|------|
| 产品经理 | | | |
| 技术负责人 | | | |
| 项目经理 | | | |

### 执行状态
- [ ] 待评估
- [ ] 评估中
- [ ] 待审批
- [ ] 已批准
- [ ] 执行中
- [ ] 已完成
- [ ] 已拒绝
- [ ] 已取消
```

---

## 场景5: 如何处理紧急Bug

### 优先级判定表

| 影响范围 ↓ \ 影响程度 → | 功能不可用 | 功能受损 | 体验下降 |
|------------------------|-----------|----------|----------|
| **全部用户** | P0-立即修复 | P1-当天修复 | P2-48小时内 |
| **部分用户(>10%)** | P1-当天修复 | P2-48小时内 | P3-本迭代内 |
| **少量用户(<10%)** | P2-48小时内 | P3-本迭代内 | P4-排期处理 |

### 优先级定义

| 级别 | 响应时间 | 修复时间 | 处理方式 |
|------|----------|----------|----------|
| **P0** | 5分钟内响应 | 2小时内修复 | 停止其他工作，全力修复；必要时回滚 |
| **P1** | 30分钟内响应 | 8小时内修复 | 当天完成，可加班处理 |
| **P2** | 2小时内响应 | 48小时内修复 | 排入当前迭代高优先级 |
| **P3** | 24小时内响应 | 本迭代内修复 | 正常排期处理 |
| **P4** | 48小时内响应 | 择期修复 | 进入Backlog等待排期 |

### 紧急修复流程

```
┌─────────────────────────────────────────────────────────────────┐
│                       紧急Bug修复流程                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌────────┐   ┌────────┐   ┌────────┐   ┌────────┐   ┌────────┐│
│  │ 1.确认 │──→│ 2.定级 │──→│ 3.修复 │──→│ 4.验证 │──→│ 5.复盘 ││
│  └────────┘   └────────┘   └────────┘   └────────┘   └────────┘│
│                                                                 │
│  各阶段产出物:                                                    │
│  ├─ 确认: Bug复现步骤、影响范围                                    │
│  ├─ 定级: 优先级、响应时间、责任人                                  │
│  ├─ 修复: Hotfix代码、代码Review                                  │
│  ├─ 验证: 测试报告、上线确认                                       │
│  └─ 复盘: 根因分析、改进措施                                       │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### P0/P1 Bug处理Checklist

**发现阶段**:
- [ ] 记录Bug发现时间
- [ ] 尝试复现并记录复现步骤
- [ ] 初步评估影响范围
- [ ] 通知相关负责人

**定级阶段**:
- [ ] 确认影响用户数量/比例
- [ ] 确认功能影响程度
- [ ] 确定优先级
- [ ] 指定修复责任人

**修复阶段**:
- [ ] 创建Hotfix分支
- [ ] 定位问题根因
- [ ] 编写修复代码
- [ ] 代码Review
- [ ] 本地验证通过

**验证阶段**:
- [ ] 测试环境验证
- [ ] 预发布环境验证
- [ ] 灰度发布（如适用）
- [ ] 全量发布
- [ ] 线上验证

**收尾阶段**:
- [ ] 更新Bug状态
- [ ] 通知相关方修复完成
- [ ] 合并代码到主干
- [ ] 记录复盘内容

---

## 场景6: 如何进行技术选型

### 选型原则

1. **业务适配** - 技术服务于业务，优先满足业务需求
2. **团队匹配** - 考虑团队技术栈和学习成本
3. **生态成熟** - 优先选择社区活跃、文档完善的技术
4. **可持续性** - 考虑长期维护成本和技术演进
5. **风险可控** - 新技术需要充分验证，避免踩坑

### 选型流程

```
┌─────────────────────────────────────────────────────────────────┐
│                        技术选型流程                              │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐        │
│  │ 1.需求   │─→│ 2.调研   │─→│ 3.评估   │─→│ 4.验证   │        │
│  │   分析   │  │   候选   │  │   对比   │  │   决策   │        │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘        │
│       │             │             │             │               │
│       ▼             ▼             ▼             ▼               │
│  - 明确场景     - 列出候选    - 多维评估    - POC验证          │
│  - 定义约束     - 收集资料    - 打分排序    - 团队评审          │
│  - 确定标准     - 初步筛选    - 风险分析    - 最终决策          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 评估模板

```markdown
## 技术选型评估报告

### 选型背景
- **选型场景**: [描述需要选型的技术领域]
- **业务需求**: [描述要解决的业务问题]
- **技术约束**: [列出已知的技术限制条件]

### 候选方案

| 方案 | 简介 | 官网/仓库 |
|------|------|-----------|
| 方案A | | |
| 方案B | | |
| 方案C | | |

### 评估维度与权重

| 维度 | 权重 | 说明 |
|------|------|------|
| 功能完整度 | 25% | 是否满足全部功能需求 |
| 性能表现 | 20% | 在预期负载下的性能指标 |
| 学习成本 | 15% | 团队掌握所需时间 |
| 社区生态 | 15% | 社区活跃度、文档质量、第三方支持 |
| 可维护性 | 10% | 代码质量、升级难度、调试便利性 |
| 成本 | 10% | 许可费用、基础设施成本 |
| 风险 | 5% | 技术成熟度、供应商锁定风险 |

### 评分对比

| 维度 | 权重 | 方案A | 方案B | 方案C |
|------|------|-------|-------|-------|
| 功能完整度 | 25% | | | |
| 性能表现 | 20% | | | |
| 学习成本 | 15% | | | |
| 社区生态 | 15% | | | |
| 可维护性 | 10% | | | |
| 成本 | 10% | | | |
| 风险 | 5% | | | |
| **加权总分** | 100% | | | |

### POC验证结果

#### 验证范围
[描述POC验证的功能点和场景]

#### 验证结论
| 验证项 | 方案A | 方案B | 方案C |
|--------|-------|-------|-------|
| | | | |

### 风险分析

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|--------|------|----------|
| | 高/中/低 | 高/中/低 | |

### 最终建议

**推荐方案**: [方案X]

**推荐理由**:
1.
2.
3.

**注意事项**:
1.
2.

### 评审记录

| 角色 | 姓名 | 意见 | 日期 |
|------|------|------|------|
| 架构师 | | | |
| 技术负责人 | | | |
| 开发代表 | | | |
```

### 常见选型领域参考

| 领域 | 考量重点 | 常见选项 |
|------|----------|----------|
| **Web框架** | 性能、生态、团队熟悉度 | React, Vue, Angular |
| **后端框架** | 性能、扩展性、开发效率 | Spring Boot, Express, Django |
| **数据库** | 数据模型、扩展性、一致性要求 | PostgreSQL, MySQL, MongoDB |
| **消息队列** | 吞吐量、可靠性、复杂度 | Kafka, RabbitMQ, Redis Streams |
| **缓存** | 性能、持久化、数据结构 | Redis, Memcached |
| **搜索引擎** | 索引性能、查询复杂度、运维成本 | Elasticsearch, Meilisearch |

---

## 附录：场景处理原则总结

1. **标准化流程** - 遵循既定流程，确保处理一致性
2. **及时沟通** - 重要决策及时同步相关方
3. **书面记录** - 重要决策和变更必须书面留痕
4. **持续改进** - 每次处理后复盘，优化流程
5. **风险意识** - 始终评估风险，制定应对预案
