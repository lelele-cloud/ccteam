# 系统架构设计技能

## 概述

系统化地进行软件系统架构设计，包括技术架构、应用架构、数据架构的设计，输出架构设计文档和架构决策记录（ADR），为开发团队提供清晰的技术蓝图。

## 适用角色

- 系统架构师（主要）
- 技术负责人
- 高级开发工程师

## 输入

- **PRD文档**：产品需求文档
- **非功能需求**：性能、安全、可用性等要求
- **技术约束**：现有技术栈、基础设施约束
- **资源约束**：团队能力、时间、预算

## 输出

- **架构设计文档**：`docs/ccteam/02-architecture/architecture-design.md`
- **架构决策记录**：`docs/ccteam/02-architecture/adr/`
- **部署架构图**：系统部署拓扑
- **技术规范**：技术选型和接口规范

## 架构设计流程

### 阶段1：需求分析与约束识别

1. **功能需求分析**
   - 核心业务流程
   - 功能模块划分
   - 用户交互模式

2. **非功能需求分析**
   ```markdown
   ## 非功能需求清单

   | 类别 | 需求 | 指标 | 优先级 |
   |------|------|------|--------|
   | 性能 | 响应时间 | P95 < 200ms | 高 |
   | 性能 | 吞吐量 | 1000 TPS | 高 |
   | 可用性 | SLA | 99.9% | 高 |
   | 安全 | 数据加密 | AES-256 | 高 |
   | 可扩展性 | 水平扩展 | 支持10x增长 | 中 |
   ```

3. **约束条件识别**
   - 技术约束：现有技术栈、团队技能
   - 业务约束：上线时间、合规要求
   - 资源约束：预算、人力

### 阶段2：架构模式选择

1. **评估候选架构模式**

   | 模式 | 适用场景 | 优点 | 缺点 |
   |------|----------|------|------|
   | 单体架构 | 小型项目、MVP | 简单、部署方便 | 扩展性差 |
   | 分层架构 | 企业应用 | 职责清晰、易维护 | 性能开销 |
   | 微服务 | 大型系统、多团队 | 独立部署、扩展灵活 | 复杂度高 |
   | 事件驱动 | 实时处理、解耦 | 高度解耦、异步 | 调试困难 |
   | CQRS | 读写分离场景 | 性能优化、灵活 | 复杂度增加 |
   | Serverless | 低流量、事件触发 | 按需付费、免运维 | 冷启动、厂商锁定 |

2. **选择决策矩阵**
   ```markdown
   ## 架构模式评估

   | 评估维度 | 权重 | 单体 | 微服务 | Serverless |
   |----------|------|------|--------|------------|
   | 开发效率 | 25% | 5 | 3 | 4 |
   | 可扩展性 | 25% | 2 | 5 | 5 |
   | 运维复杂度 | 20% | 5 | 2 | 5 |
   | 性能 | 15% | 4 | 4 | 3 |
   | 成本 | 15% | 4 | 3 | 5 |
   | **总分** | - | 4.0 | 3.5 | 4.3 |
   ```

### 阶段3：模块划分

1. **领域驱动设计（DDD）方法**
   - 识别核心域、支撑域、通用域
   - 定义限界上下文
   - 设计上下文映射

2. **模块划分原则**
   - **单一职责**：每个模块只负责一个功能领域
   - **高内聚低耦合**：相关功能聚合，减少模块间依赖
   - **接口隔离**：通过清晰接口交互
   - **依赖倒置**：依赖抽象而非实现

3. **模块关系图**
   ```
   ┌─────────────────────────────────────────┐
   │              API Gateway                 │
   └─────────────────┬───────────────────────┘
                     │
   ┌─────────┬───────┴───────┬─────────┐
   │         │               │         │
   ┌─┴─┐   ┌─┴─┐         ┌─┴─┐   ┌─┴─┐
   │用户│   │订单│         │商品│   │支付│
   │服务│   │服务│         │服务│   │服务│
   └─┬─┘   └─┬─┘         └─┬─┘   └─┬─┘
     │       │             │       │
   ┌─┴───────┴─────────────┴───────┴─┐
   │          消息队列/事件总线         │
   └─────────────────────────────────┘
   ```

### 阶段4：技术架构设计

1. **分层架构设计**
   ```
   ┌─────────────────────────────────────┐
   │         Presentation Layer          │
   │    (Web/Mobile/API Gateway)         │
   ├─────────────────────────────────────┤
   │         Application Layer           │
   │      (Business Logic/Services)      │
   ├─────────────────────────────────────┤
   │          Domain Layer               │
   │     (Entities/Value Objects)        │
   ├─────────────────────────────────────┤
   │       Infrastructure Layer          │
   │   (Database/Cache/External APIs)    │
   └─────────────────────────────────────┘
   ```

2. **数据架构设计**
   - 数据存储选型
   - 数据分区策略
   - 缓存策略
   - 数据同步方案

3. **安全架构设计**
   - 认证授权机制
   - 数据加密方案
   - 网络安全策略
   - 审计日志

### 阶段5：接口设计

1. **服务接口定义**
   - RESTful API 设计
   - gRPC 服务定义
   - 消息格式规范

2. **接口文档规范**
   ```yaml
   # OpenAPI 规范示例
   openapi: 3.0.0
   info:
     title: User Service API
     version: 1.0.0
   paths:
     /users:
       get:
         summary: 获取用户列表
         responses:
           '200':
             description: 成功
   ```

### 阶段6：输出文档

生成标准架构设计文档：

```markdown
# 系统架构设计文档

## 1. 概述
### 1.1 文档目的
### 1.2 系统概述
### 1.3 设计目标

## 2. 架构约束
### 2.1 功能需求约束
### 2.2 非功能需求约束
### 2.3 技术约束
### 2.4 资源约束

## 3. 架构设计
### 3.1 架构模式
### 3.2 系统架构图
### 3.3 模块划分
### 3.4 模块交互

## 4. 技术架构
### 4.1 技术选型
### 4.2 分层架构
### 4.3 数据架构
### 4.4 安全架构

## 5. 部署架构
### 5.1 部署拓扑
### 5.2 环境规划
### 5.3 容量规划

## 6. 接口设计
### 6.1 外部接口
### 6.2 内部接口

## 7. 架构决策记录
[链接到ADR目录]

## 8. 附录
### 8.1 术语表
### 8.2 参考文档
```

## ADR（架构决策记录）格式

```markdown
# ADR-[编号]: [决策标题]

## 状态
[提议中 | 已接受 | 已废弃 | 已取代]

## 上下文
[描述问题背景和约束条件]

## 决策
[描述做出的决策]

## 理由
[解释为什么做出这个决策]

### 考虑的选项
1. **选项A**: [描述]
   - 优点: ...
   - 缺点: ...

2. **选项B**: [描述]
   - 优点: ...
   - 缺点: ...

### 选择理由
[解释为什么选择当前方案]

## 后果
### 正面影响
- [影响1]

### 负面影响
- [影响1]

### 风险
- [风险1]

## 相关决策
- ADR-XXX: [相关决策]

## 参考资料
- [链接]

---
记录日期：YYYY-MM-DD
决策者：[姓名]
```

## 质量检查

### 完整性检查
- [ ] 所有功能需求都有对应的架构设计
- [ ] 非功能需求有明确的技术方案
- [ ] 模块划分完整，职责清晰
- [ ] 接口定义完整

### 合理性检查
- [ ] 架构模式符合业务需求
- [ ] 技术选型有充分理由
- [ ] 性能设计满足指标要求
- [ ] 安全设计符合要求

### 可行性检查
- [ ] 技术方案团队可实现
- [ ] 资源需求在预算内
- [ ] 时间计划可行
- [ ] 风险可控

### 可维护性检查
- [ ] 架构文档清晰完整
- [ ] ADR 记录关键决策
- [ ] 模块边界清晰
- [ ] 扩展点已预留

## 相关技能

- [tech-selection](./tech-selection.md) - 技术选型技能
