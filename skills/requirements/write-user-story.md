# 用户故事编写技能

## 概述

使用标准格式编写高质量的用户故事，包含清晰的验收标准和合理的故事点估算，支持敏捷开发团队的迭代规划和交付。

## 适用角色

- 产品经理（主要）
- 项目经理
- 技术负责人
- 开发工程师

## 输入

- **需求分析报告**：已完成的需求分析
- **PRD文档**：产品需求文档
- **用户画像**：目标用户定义
- **技术评估**：技术可行性评估（用于故事点估算）

## 输出

- **用户故事文档**：`docs/ccteam/01-requirements/user-stories.md`
- **故事卡片**：可导入项目管理工具的故事列表
- **验收测试用例**：基于验收标准的测试用例

## 用户故事格式

### 标准格式

```markdown
## US-[编号] [故事标题]

### 用户故事
作为 [用户角色]，
我希望 [功能/行为]，
以便 [业务价值/目的]。

### 优先级
- 优先级：P0/P1/P2/P3
- 故事点：[数字]

### 验收标准
**场景1：[场景名称]**
- Given [前置条件]
- When [触发动作]
- Then [期望结果]

**场景2：[场景名称]**
- Given [前置条件]
- When [触发动作]
- Then [期望结果]

### 技术说明
[可选的技术实现说明]

### 依赖关系
- 依赖：[依赖的其他故事]
- 阻塞：[被此故事阻塞的故事]

### 备注
[其他需要说明的内容]
```

### INVEST原则

编写用户故事时遵循INVEST原则：

| 原则 | 说明 | 检查点 |
|------|------|--------|
| **I**ndependent（独立） | 故事间尽量减少依赖 | 能否单独开发和测试？ |
| **N**egotiable（可协商） | 细节可以讨论调整 | 是否留有讨论空间？ |
| **V**aluable（有价值） | 对用户有明确价值 | 用户为什么需要这个？ |
| **E**stimable（可估算） | 能够评估工作量 | 团队能否给出估算？ |
| **S**mall（适当小） | 一个迭代内可完成 | 能否在一个Sprint完成？ |
| **T**estable（可测试） | 有明确的验收标准 | 如何验证已完成？ |

## 验收标准编写（Given-When-Then）

### 结构说明

```markdown
Given [上下文/前置条件]
  And [附加条件（可选）]
When [动作/事件]
  And [附加动作（可选）]
Then [期望结果]
  And [附加结果（可选）]
```

### 示例

```markdown
**场景：登录成功**
- Given 用户已注册且账号状态正常
- And 用户在登录页面
- When 用户输入正确的用户名和密码
- And 点击登录按钮
- Then 用户成功登录系统
- And 页面跳转到首页
- And 显示用户昵称

**场景：登录失败-密码错误**
- Given 用户已注册且账号状态正常
- And 用户在登录页面
- When 用户输入正确的用户名但错误的密码
- And 点击登录按钮
- Then 登录失败
- And 显示错误提示"用户名或密码错误"
- And 用户停留在登录页面
```

### 验收标准最佳实践

1. **覆盖正常流程和异常流程**
   - 成功场景
   - 失败场景
   - 边界条件

2. **使用用户视角**
   - 描述用户看到的结果
   - 避免技术实现细节

3. **保持可测试性**
   - 结果要可观察
   - 条件要可重现

## 故事点估算

### 斐波那契数列估算法

使用修正的斐波那契数列：1, 2, 3, 5, 8, 13, 20, 40, 100

| 故事点 | 复杂度 | 参考时间 | 说明 |
|--------|--------|----------|------|
| 1 | 非常简单 | 0.5天 | 简单配置修改、文案调整 |
| 2 | 简单 | 1天 | 简单功能、少量代码修改 |
| 3 | 较简单 | 1.5天 | 标准功能、熟悉的模式 |
| 5 | 中等 | 2-3天 | 需要一些设计思考 |
| 8 | 较复杂 | 3-5天 | 涉及多个模块、需要协调 |
| 13 | 复杂 | 1周 | 高复杂度、需要技术调研 |
| 20 | 非常复杂 | 1-2周 | 建议拆分为更小的故事 |
| 40+ | Epic | - | 必须拆分 |

### 估算考虑因素

```markdown
## 估算因素清单

### 复杂度因素
- [ ] 业务逻辑复杂程度
- [ ] 技术实现难度
- [ ] 是否涉及新技术
- [ ] 代码影响范围

### 不确定性因素
- [ ] 需求是否清晰
- [ ] 是否有技术风险
- [ ] 外部依赖是否稳定
- [ ] 团队是否熟悉

### 工作量因素
- [ ] 代码编写量
- [ ] 测试覆盖要求
- [ ] 文档需求
- [ ] 评审和返工
```

### 相对估算方法

1. **选择基准故事**
   - 选择团队熟悉的中等复杂度故事作为基准（5点）

2. **比较估算**
   - 新故事与基准比较
   - 比基准简单→减少点数
   - 比基准复杂→增加点数

3. **团队共识**
   - 使用规划扑克
   - 差异大时讨论原因
   - 达成共识后记录

## 执行步骤

### 步骤1：准备
1. 回顾需求分析报告和PRD
2. 确认用户画像和用户旅程
3. 准备故事拆分清单

### 步骤2：故事拆分
1. 按功能模块拆分
2. 确保每个故事符合INVEST原则
3. 建立故事间的依赖关系

### 步骤3：编写用户故事
1. 使用标准格式编写
2. 明确用户角色
3. 描述功能和价值

### 步骤4：编写验收标准
1. 覆盖主要场景
2. 包含异常场景
3. 使用Given-When-Then格式

### 步骤5：故事点估算
1. 选择基准故事
2. 相对估算
3. 团队评审确认

### 步骤6：评审与完善
1. 与开发团队评审
2. 确认技术可行性
3. 调整估算和依赖

## 质量检查

### 故事质量
- [ ] 符合INVEST原则
- [ ] 用户角色明确
- [ ] 业务价值清晰
- [ ] 功能描述具体

### 验收标准质量
- [ ] 覆盖正常流程
- [ ] 覆盖异常流程
- [ ] 格式规范（GWT）
- [ ] 可测试、可验证

### 估算质量
- [ ] 使用相对估算
- [ ] 团队达成共识
- [ ] 大故事已拆分
- [ ] 依赖关系明确

### 完整性
- [ ] 所有功能都有对应故事
- [ ] 故事编号唯一
- [ ] 优先级已标注
- [ ] 依赖关系完整

## 用户故事模板

### 基础模板

```markdown
# 用户故事清单

## Epic: [史诗名称]

### US-001 [故事标题]

**用户故事**
作为 [角色]，
我希望 [功能]，
以便 [价值]。

**优先级**: P0 | **故事点**: 5

**验收标准**

场景1：[正常流程]
- Given [条件]
- When [动作]
- Then [结果]

场景2：[异常流程]
- Given [条件]
- When [动作]
- Then [结果]

**依赖**: 无
**备注**: [备注内容]

---
```

### 批量导出模板（CSV）

```csv
ID,标题,角色,功能,价值,优先级,故事点,验收标准,依赖
US-001,用户登录,注册用户,登录系统,访问个人数据,P0,3,"登录成功;登录失败提示",无
US-002,密码重置,注册用户,重置密码,恢复账号访问,P1,5,"邮件发送;链接有效期",US-001
```

## 常见问题

| 问题 | 解决方案 |
|------|----------|
| 故事太大 | 按用户操作步骤或数据维度拆分 |
| 故事间依赖过多 | 重新组织故事边界，考虑纵向切片 |
| 验收标准模糊 | 使用具体示例，避免"正确地"、"合理地"等词 |
| 估算差异大 | 讨论不同观点，识别隐藏复杂度 |
| 技术故事无用户 | 以"作为开发团队"开头，说明技术价值 |

## 相关技能

- [analyze-requirement](./analyze-requirement.md) - 需求分析技能
- [write-prd](./write-prd.md) - PRD编写技能
